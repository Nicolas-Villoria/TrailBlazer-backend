<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrailBlazer - Discover Routes to Catalunya's Monuments</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Full-screen Map Background -->
    <div id="map"></div>
    
    <!-- API Status Indicator -->
    <div id="apiStatus" class="api-status api-disconnected">
        <i class="fas fa-circle-notch fa-spin"></i> Connecting...
    </div>

    <!-- Floating Control Panel -->
    <div class="control-panel" id="controlPanel">
        <div class="collapse-btn" onclick="togglePanel()">
            <i class="fas fa-bars"></i>
        </div>
        
        <div class="panel-content">
            <!-- Header -->
            <div class="panel-header">
                <h1><i class="fas fa-hiking"></i> TrailBlazer</h1>
                <p>Discover routes to monuments</p>
            </div>
            
            <!-- Start Point Section -->
            <div class="control-section">
                <h5><i class="fas fa-map-marker-alt text-danger"></i> Start Point</h5>
                <div class="row g-2 mb-2">
                    <div class="col-6">
                        <input type="number" class="form-control" id="startLat" 
                               placeholder="Latitude" step="0.000001">
                    </div>
                    <div class="col-6">
                        <input type="number" class="form-control" id="startLon" 
                               placeholder="Longitude" step="0.000001">
                    </div>
                </div>
                <button class="btn btn-custom mb-2" onclick="setCurrentLocation()">
                    <i class="fas fa-location-crosshairs"></i> Use My Location
                </button>
                <small class="text-muted d-block text-center">
                    <i class="fas fa-info-circle"></i> Or click on the map
                </small>
            </div>
            
            <!-- Search Radius Section -->
            <div class="control-section">
                <h5><i class="fas fa-compass text-primary"></i> Search Radius</h5>
                <label for="searchRadius" class="form-label mb-2">
                    <strong id="radiusDisplay">10</strong> km
                    <small class="text-muted">(max walking distance)</small>
                </label>
                <input type="range" class="form-range" id="searchRadius" 
                       min="1" max="50" value="10" step="1" 
                       oninput="updateSearchRadius(this.value)">
                <div class="d-flex justify-content-between" style="font-size: 0.75em; color: #6c757d;">
                    <span>1 km</span>
                    <span>25 km</span>
                    <span>50 km</span>
                </div>
            </div>
            
            <!-- Monument Type Section -->
            <div class="control-section">
                <h5><i class="fas fa-landmark text-warning"></i> Monument Type</h5>
                <select class="form-select mb-2" id="monumentType">
                    <option value="">Select type...</option>
                    <option value="militars">üè∞ Military (Castles)</option>
                    <option value="religiosos">‚õ™ Religious (Churches)</option>
                    <option value="civils">üèõÔ∏è Civil (Palaces)</option>
                </select>
                <button class="btn btn-success-custom" onclick="previewMonuments()">
                    <i class="fas fa-eye"></i> Preview Monuments
                </button>
            </div>
            
            <!-- Calculate Button -->
            <div class="control-section">
                <button class="btn btn-custom" onclick="calculateRoutes()" 
                        style="padding: 12px; font-size: 1em;">
                    <i class="fas fa-route"></i> Calculate Routes
                </button>
            </div>
            
            <!-- Progress Section -->
            <div id="progressSection" style="display: none;">
                <div class="control-section">
                    <h5><i class="fas fa-spinner fa-spin"></i> Calculating Routes</h5>
                    <div class="info-box" style="padding: 8px;">
                        <small><strong>Job ID:</strong> <code id="jobId" style="font-size: 0.8em;">-</code></small>
                        <span id="jobStatus" class="status-badge status-pending">Pending</span>
                    </div>
                    <div class="progress mb-2">
                        <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" 
                             role="progressbar" style="width: 0%">
                            <span id="progressText">0%</span>
                        </div>
                    </div>
                    <p id="progressStatus" class="text-center mb-0" style="font-size: 0.9em;">
                        <i class="fas fa-rocket"></i> Initializing...
                    </p>
                </div>
            </div>
            
            <!-- Results Section -->
            <div id="resultsSection" style="display: none;">
                <div class="control-section">
                    <h5><i class="fas fa-flag-checkered"></i> Results</h5>
                    
                    <div class="row mb-2">
                        <div class="col-6">
                            <div class="info-box" style="padding: 8px; text-align: center;">
                                <small class="d-block"><i class="fas fa-check-circle text-success"></i> Reachable</small>
                                <strong id="reachableCount" style="font-size: 1.3em;">0</strong>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="info-box" style="background: rgba(255, 243, 205, 0.9); padding: 8px; text-align: center;">
                                <small class="d-block"><i class="fas fa-times-circle text-warning"></i> Unreachable</small>
                                <strong id="unreachableCount" style="font-size: 1.3em;">0</strong>
                            </div>
                        </div>
                    </div>
                    
                    <a id="downloadPNG" class="download-btn btn btn-primary" href="#" target="_blank">
                        <i class="fas fa-image"></i> Download PNG Map
                    </a>
                    <a id="downloadKML" class="download-btn btn btn-success" href="#" target="_blank">
                        <i class="fas fa-map"></i> Download KML File
                    </a>
                    
                    <h6 style="margin-top: 15px; font-size: 0.95em;"><i class="fas fa-list"></i> Route Details</h6>
                    <div id="routeDetails" style="max-height: 300px; overflow-y: auto;"></div>
                </div>
            </div>
            
            <!-- Monuments Preview Section -->
            <div id="monumentsSection" style="display: none;">
                <div class="control-section">
                    <h5><i class="fas fa-landmark"></i> Monuments</h5>
                    <p class="text-muted mb-2" style="font-size: 0.9em;">
                        Found <strong id="monumentCount">0</strong> monuments
                    </p>
                    <div id="monumentsList" style="max-height: 250px; overflow-y: auto;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
